# Yes Steve Model 模组使用说明

## 一、简介

Yes Steve Model 模组是一个修改原版玩家模型的 `Minecraft Forge` 模组，它采用了 `geckolib` 作为核心，使用 Minecraft 基岩版模型和动画文件。从而使玩家能够随心所欲的自定义玩家模型和动画。

![001](https://s2.loli.net/2023/01/01/RAor58n6LBct3kW.jpg)

Yes Steve Model 模组考虑到了服务器群体的模组需求，采用了诸多适用于服务器环境的设计，包括但不限于：

- 自动同步客户端模型：普通玩家在进入服务器时，服务器会**自动**把模型同步到玩家的电脑上。
- 加密模型文件：发送到玩家客户端的模型全部是**加密的二进制文件**，有效避免模型窃取问题！
- 模型权限功能：模型可以单独设置授权，只有 OP 输入指令授权后，特定的模型才可以使用。
- 原版玩家模型修改：添加了默认的 Steve 和 Alex 模型，这两个模型均可自动调用玩家皮肤显示。
- 简单的自定义功能：模型自定义功能极其简单，只需要在特定文件夹放置模型、材质和动画文件，在游戏内输入重载指令即可自动加载、同步。**不需要书写任何配置文件**！
- 动画轮盘功能：当按下 `Z` 键时，能够打开一个轮盘动画。通过它你可以方便播放各种有趣的动画（比如动作、表情等）

对于客户端玩家来说，使用也极其简单。当玩家首次进入服务器后等待十几秒（模型同步的耗时），即可使用快捷键 `Alt` + `Y` 打开如下 GUI 界面：

![1.png](https://s2.loli.net/2023/02/11/upUCTlqoBtySFW9.png)

**① 模型切换按钮**：点击即可切换为对应的模型。如果按钮右上角图标为红色，说明该模型未授权。图标内数字代表该模型可切换的材质数量。

**② 模型类别切换按钮**：可以切换所有模型、已授权模型、收藏模型和原版模型（目前只有 Steve 和 Alex 模型）

**③ 详情界面按钮**：点击可进入模型详情界面，查看模型所有可用材质和动画。中间的预览窗口可以使用鼠标左键拖拽旋转模型、鼠标右键拖拽移动模型、鼠标滚轮滑动缩放模型。点击右侧材质选择框可以选择不同的材质。点击左侧动画列表，可以预览播放不同的动画。

![3.png](https://s2.loli.net/2023/02/11/UxtCNy9wEg1XjSI.png)



## 二、如何制作自定义模型

Yes Steve Model 模组采用了 `geckolib` 作为核心，所有它支持 `geckolib` 兼容的`基岩版 1.12.0 `版本模型文件和`基岩版 1.8.0 `版本动画文件。

自定义模型文件全部放置在游戏主目录下的 `config/yes_steve_model` 文件夹下。`yes_steve_model` 下会自动生成四个文件夹：

- `auth ` 文件夹：用来放置自定义模型，该位置的自定义模型**必须授权**后才可以使用。

- `cache` 文件夹：系统自动从服务端获取的加密模型文件缓存文件夹。

- `custom` 文件夹：用来放置自定义模型，该位置的自定义模型**无需授权**就可使用。

- `export` 文件夹：当在游戏内使用了 `/ysm export` 指令，生成的 `ysm` 专属格式的模型就在这。

你可以选择在 `auth` 或者 `custom` 文件夹下放置自定义模型文件，其文件结构如下：

这其中只有三个部分是必须的：`main.json`，`arm.json`，任意一个 `png` 格式的材质。

```
custom （或 auth）文件夹
│
└─default                  模型包文件夹，游戏将会以此文件夹名作为模型 ID
    │ 
    ├─main.json            主模型文件（固定名称）
    ├─arm.json             手臂模型文件，用于第一人称手臂的显示（固定名称）
    ├─main.animation.json  主模型文件的动画文件（固定名称）
    ├─extra.animation.json 轮盘动画文件（固定名称）
    ├─happy_skin.png       主模型文件贴图1（名称可自定义，会作为游戏内显示名称）
    ├─...                  任意多个贴图文件
    └─good_cloth_12.png    主模型文件贴图2（名称可自定义，会作为游戏内显示名称）    
```

自定义模型、动画、材质文件均需放置在一个文件夹中。文件夹、材质名称等只能使用 `小写英文字符、数字、下划线` 等字符。

你也可以把这些自定义模型、动画、材质文件全部打包成 zip 格式的文件**（不要错误的打包了文件夹）**，文件名还是需要遵循上述规定。

你甚至可以使用本模组专门提供的 ysm 格式模型。这个模型格式进行了一些简单加密，可以有效避免模型被第三方人员破解。后面会介绍如何获得 ysm 格式的模型。

### 1.模型文件的制作

Yes Steve Model 模组主模型文件命名必须为 `main.json`。其使用的动画文件进行了标准化设计，只需要按照特定的布局方式来制作，即可自动兼容。

在运行游戏后，游戏主目录下的 `config\yes_steve_model\custom\default` 文件夹下会自动生成模型标准模型和动画文件，你可以在其基础上进行二次修改和分发。

> 因为模型命名极其混乱，故统一对模型命名进行规范。
> **当然，你可以不遵守这些标准，模型依旧可以安全加载。**

####  ①.书写格式

组名应该全部采用大写驼峰式，并采用规范英文单词描述，按照 `形容词` + `名称` 形式进行组合，示例如下：

左手臂：`LeftArm`

整个头部：`AllHead`

####  ②.简洁原则

命名应该尽可能使用简洁易懂的英文单词，示例如下：

表示`整个`使用 `All` 而不是 `Whole`，因为前者更加简洁

表示`眼睛`使用 `Eyes` 而不是 `HeadEyes`，因为`眼睛`肯定处于 `Head` 分组中，无需强调

####  ③.无意义分组

部分模型中为了方便旋转，位移。对部分模型进行了分组，但并不附加动画和其他操作，可使用 `父类` + `数字编号` 的方式命名，示例如下：

某 `Mouth` 分组为了模型制作方便，设置了多个分组，但并没有特定的意义，也没有动画。可将其命名为 `Mouth1`， `Mouth2`， `Mouth3`等

####  ④.特定组名

某些特定组名不允许更改，否则会导致游戏部分内容无法正常显示：

|              组名              |                             说明                             |
| :----------------------------: | :----------------------------------------------------------: |
|             `Head`             |              游戏会默认添加头部随视角摆动的动画              |
|  `LeftHand` `LeftHandLocator`  | 左手手持物品的定位组<br/>`LeftHandLocator`必须位于`LeftHand`里面<br>由`LeftHandLocator`的旋转点定位手持物品 |
| `RightHand` `RightHandLocator` | 右手手持物品的定位组<br/>`RightHandLocator`必须位于`RightHand`里面<br/>由`RightHandLocator`的旋转点定位手持物品 |

### 2.第一人称视角手部模型的制作

第一人称视角的手部模型必须命名为 `arm.json`，可通过主模型二次修改获得该文件，它与主模型共用一套贴图。其制作方法可参考如下步骤：

1. 将主模型文件复制一份；
2. 找到 `LeftArm` 和 `RightArm` 分组，将其复制到**根目录**下；
3. 删除整个 `Root` 分组；
4. 粘贴刚刚复制的 `LeftArm` 和 `RightArm` 分组；
5. 将 `LeftArm` 和 `RightArm` 分组的 `X` `Y` `Z` 旋转角度均修改为 0（内部分组不需要修改，修改后手臂应为垂直向下）。

我们还为手部模型添加了背景显示功能，在根目录下创建名为 `Background` 名字的分组，游戏将会在第一人称视角时将这个分组渲染为背景。不受玩家手持物品、使用状态的影响。

最后，你做好的模型在 Blockbench 里面看起来应该是这样的：

![2.png](https://s2.loli.net/2023/02/11/yLC1siW2aFvStXE.png)

### 3.贴图文件的制作

- 材质使用 `png` 格式材质，不建议使用**半透明**贴图，这会造成各种渲染错误；

- 材质文件名只能使用 `小写英文字符、数字、下划线` 等字符，其他没有限制；
- 模型支持多个贴图，你可以放置若干份贴图文件，游戏均会智能识别。

### 4.动画文件的制作

动画文件是可选选项。没有动画文件，或者缺失部分动画时，游戏均会智能调用默认的动画文件。如果你的模型是按照默认模型二次修改的，那么即可完美兼容。

游戏内只有一个动画是代码添加的，不可修改：

- 头部随鼠标摆动的动画：智能识别 `Head` 分组添加的动画

> 如果你不喜欢这个代码控制的动画，只需要将头部分组起个其他的名字即可

如下动画是自定义的主动画,放置于 `main.animation.json` 文件中，可进行二次修改：

|     名称      |            作用            |               备注               |
| :-----------: | :------------------------: | :------------------------------: |
|     walk      |   在玩家普通行走时的动画   |             循环播放             |
|      run      |     在玩家疾跑时的动画     |             循环播放             |
|   climbing    |    玩家在活板门下的动画    |             循环播放             |
|   sneaking    | 玩家潜行，但不移动时的动画 |             循环播放             |
|     sneak     | 玩家潜行，并且行走时的动画 |             循环播放             |
|     swim      |      玩家游泳时的动画      |             循环播放             |
|  swim_stand   | 玩家在水中站立式游泳的动画 |             循环播放             |
|   attacked    |     玩家被攻击时的动画     |             单次播放             |
|     jump      |    玩家离开地面时的动画    | 飞行和跳跃都调用此动画，循环播放 |
|      fly      | 玩家在鞘翅飞行时播放的动画 |             循环播放             |
|     boat      |    玩家坐在船上时的动画    |             循环播放             |
| use_righthand |  玩家使用右手时播放的动画  |             单次播放             |
| use_lefthand  |  玩家使用左手时播放的动画  |             单次播放             |
|     sleep     |      玩家睡觉时的动画      |             循环播放             |
|     ride      |   玩家骑马（驴）时的动画   |             循环播放             |
|   ride_pig    |      玩家骑猪时的动画      |             循环播放             |
|      sit      |      玩家坐下时的动画      |             循环播放             |
|     idle      |     无任何操作时的动画     |             循环播放             |

以下是八个并行动画，并行动画与主动画互相独立，也放置于 `main.animation.json` 文件中。用于制作那些无论在什么情况下均会播放的内容：尾巴、耳朵的摆动，眨眼动画等等。
|                             名称                             |            作用            |   备注   |
| :----------------------------------------------------------: | :------------------------: | :------: |
| `parallel0` `parallel1`<br>`parallel2` `parallel3`<br>`parallel4` `parallel5`<br>`parallel6` `parallel7` | 与主动画互相独立，同时播放 | 循环播放 |

以下动画是八个额外动画，额外动画需单独放置于 `extra.animation.json` 文件中，这些动画会在使用动画轮盘时进行播放：

|                             名称                             |             作用             |                备注                |
| :----------------------------------------------------------: | :--------------------------: | :--------------------------------: |
| `extra0` `extra1`<br>`extra2` `extra3`<br>`extra4` `extra5`<br>`extra6` `extra7` | 使用动画轮盘播放对应额外动画 | 依据动画文件设定的循环类型进行播放 |

> 注意：并行动画优先级高于主动画，如果主动画和并行动画同时**操作了同一个骨骼**，那么并行动画将会覆盖主动画。

## 三、相关指令

模组全部采用 `/ysm` 开头的指令，均需要 OP 2 等级权限才可以使用。所有的指令添加了游戏内的提示功能，所有模型 ID 、玩家 ID 即可智能提示。

- `/ysm model reload` 重载全部模型文件：同时还会将模型文件向所有客户端玩家全部同步一次；
- `/ysm model set <player> <model_id> <texture_id> [ignore_auth]` 将特定模型、材质赋予给某个玩家，最后的 `ignore_auth` 参数是可选参数，当设置为 true 时，会无视模型授权，强制为玩家赋予模型；
- `/ysm play <player> <animation_name>` 强制玩家播放 xxx 动画；
- `/ysm play <player> stop` 清除之前强制玩家播放的动画；
- `/ysm auth <player> all` 向玩家授权全部模型；
- `/ysm auth <player> clear` 清除玩家所有授权模型；
- `/ysm auth <player> add <model_id>` 向玩家授权 xxx 模型；
- `/ysm auth <player> remove <model_id>` 清除玩家授权的 xxx 模型；
- `/ysm export <model_id>` 将某个模型导出成 ysm 专属模型格式。

	> YSM 专属格式的模型采用了一些成熟的加密功能，将模型、材质、动画等全部打包为一个文件，并能方便的被游戏所读取。既可以让模型制作者共享他们制作的模型，又可以保护其模型不被第三方玩家随便窃取倒卖。

## 四、MoLang 语法拓展和介绍

MoLang 是 mojang 官方为基岩版动画设计的一种极其简单的语言，我们可以通过 MoLang 实现各种复杂的动画。

为了更加清晰的说明什么是 MoLang，以及理解它的机制，我们从基岩版动画的机制说起。

基岩版动画的机制非常简单，在不同的时间点新建关键帧，设定某个组件的位置/旋转/缩放。当开始播放动画时，程序就会自动计算出补间动画，使组件从某个地方移动/旋转/缩放到另一个地方，从而做出动画的效果。

![5.png](https://s2.loli.net/2023/02/11/xykIWa7bTqSBnfm.png)

我们给每个关键帧设置的是一个具体的数字，决定了播放到此关键帧时，组件所处的位置/旋转的角度/缩放的大小

![6.png](https://s2.loli.net/2023/02/11/Uz8XTsCNJMcb3tZ.png)

但是一些特殊情况下，这个数字不一定是固定的。比如我们期望玩家手持物品时摆动角度为 30 度，但空手时摆动角度为 60 度，这时我们就可以使用 MoLang 表达式了。

一个常用的动画设计是显示/隐藏模型，比如我们期望在玩家穿戴头盔时，显示头盔组件。我们可以使用缩放功能来隐藏组件，当组件的 X Y Z 缩放均为 0 时，该组件就被隐藏了，所以我们可以在 BlockBench 里面这么写：

![7.png](https://s2.loli.net/2023/02/11/1gAHJNZfwmu6qzL.png)

这里的 `ysm.has_helmet` 就是一个 MoLang 参数，它会在玩家穿戴头盔时返回数字 1，而在没有穿戴头盔时返回数字 0，正好做到了我们想要的隐藏/显示功能。

一直以来，长发模型是一个极为头疼的问题。当玩家抬头时，长长的头发就会随头转动，直戳戳的穿入玩家的身体内。我们也可以用 MoLang 来巧妙的解决这个问题。思路如下：

1. 当玩家仰头时，头发不再随头转动，而是垂直向下（也就是头发旋转角度与头部正好相反，互相抵消）
2. 当玩家俯看时，头发随头转动（也就是旋转角度为 0）

那么我们就可以这样书写 MoLang 参数：

![8.png](https://s2.loli.net/2023/02/11/POS9uIYbKBfJwxi.png)

我们来逐条介绍这个参数的意思：

这是一个条件式的写法，它的格式是这样写的 `判断条件 ? 如果符合时返回的结果 : 如果不符时返回的结果`

```molang
(ysm.head_pitch > 0) ? -ysm.head_pitch : 0
```

`（ysm.head_pitch > 0）`：判断条件。玩家俯仰的角度是 -90 度到 90 度，这里判断玩家俯仰的角度是否大于 0 度，用括号括更加直观。

`-ysm.head_pitch`：当玩家俯仰角度大于 0 时（也就是抬头时），我们特意取反，把头发旋转角度抵消回去。

`0`：当玩家俯仰角度小于 0 时（也就是俯视时），我们将其变成 0，这样头发就会随头旋转。

当然，MoLang 本身还有更为复杂的用法，这里我们暂时不再赘述。

我们在下方列举出本模组添加的各种变量，你可以方便的制作出各种动画：

|        参数名         |              作用              |               数值               |
| :-------------------: | :----------------------------: | :------------------------------: |
|    `ysm.head_yaw`     |   玩家头部面向的角度（左右）   |           -180 到 180            |
|   `ysm.head_pitch`    |   玩家头部俯仰的角度（上下）   |            -90 到 90             |
|   `ysm.has_helmet`    |        玩家是否穿戴头盔        |       穿戴时为 1，否则为 0       |
| `ysm.has_chest_plate` |        玩家是否穿戴胸甲        |       穿戴时为 1，否则为 0       |
|  `ysm.has_leggings`   |        玩家是否穿戴护腿        |       穿戴时为 1，否则为 0       |
|    `ysm.has_boots`    |        玩家是否穿戴靴子        |       穿戴时为 1，否则为 0       |
|  `ysm.has_mainhand`   |      玩家主手是否持有物品      |      有物品时为 1，否则为 0      |
|   `ysm.has_offhand`   |      玩家副手是否持有物品      |      有物品时为 1，否则为 0      |
|  `ysm.is_close_eyes`  | 是否应当闭眼（用于眨眼和睡觉） |    当闭眼时为 1，不闭眼时为 0    |
|  `ysm.is_passenger`   |      玩家是否骑乘某个实体      |       骑乘时为 1，否则为 0       |
|    `ysm.is_sleep`     |      玩家是否处于睡觉状态      |       睡觉时为 1，否则为 0       |
|    `ysm.is_sneak`     |      玩家是否处于潜行状态      |       潜行时为 1，否则为 0       |
|   `ysm.armor_value`   |           玩家护甲值           |             0 到 20              |
|    `ysm.hurt_time`    |           玩家受伤值           | 当玩家受伤时此值为正数，否则为 0 |
